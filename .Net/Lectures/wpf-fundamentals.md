# ВВЕДЕНИЕ В WPF

## История

Базовые технологии большинства интерфейсов в Windows – интерфейс графического
устройства (Graphics Device Interface, GDI) и подсистема USER – появились в
Windows 1.0 еще в 1985 году. В начале 1990-х годов компания Silicon Graphics
разработала ставшую популярной графическую библиотеку OpenGL для двумерной и
трехмерной графики как в Windows, так и в других системах. Она была с восторгом
принята компаниями, работающими в сфере создания систем автоматизированного
проектирования, программ визуализации научных данных и игр. Технология Microsoft
DirectX, представленная в 1995 году, обеспечила высокоскоростную альтернативу
для 2D-графики, ввода, сетевого взаимодействия, работы со звуком, а со временем
и 3D-графики (которая стала возможной с версией DirectX 2, вышедшей в 1996
году).

После появления каркаса .NET и управляемого кода (в 2002 году) разработчики
получили очень продуктивную модель для создания Windows и веб-приложений.
Включенная в нее технология Windows Forms (основанная на GDI+) стала основным
способом создания пользовательских интерфейсов в Windows для разработчиков на
C#, Visual Basic и (в меньшей степени) С++. Она пользовалась успехом и оказалась
весьма продуктивной, но имела фундаментальные ограничения, уходящие корнями в
GDI+ и подсистему USER.

Хотя Windows Forms — зрелый и полнофункциональный набор инструментов, он был
тесно привязан к некоторым частям внутреннего устройства Windows, которые не
слишком изменились за последние 10 лет. Что более существенно, при создании
визуального представления стандартных пользовательских интерфейсных элементов,
таких как кнопки, текстовые поля, флажки и т.п., Windows Forms полагается на
Windows API. В результате его ингредиенты мало поддаются настройке и изменениям.

Например, чтобы построить стилизованную блестящую кнопку, придется создать
специальный элемент управления и нарисовать каждый аспект этой новой кнопки (во
всех разных состояниях), используя низкоуровневую модель рисования. Хуже того,
обычные окна разрезаются на отдельные области, и каждому элементу управления
отводится собственная такая область. В результате не существует такого хорошего
способа рисования в одном элементе управления (например, эффекта свечения под
кнопки), чтобы он распространялся на область, принадлежащую другому элементу. И
не стоит даже думать о создании анимационных эффектов вроде вращающегося текста,
мерцающих кнопок, сворачивающихся окон или активных предварительных просмотров,
потому что каждая деталь должна быть нарисована вручную.

В Windows Presentation Foundation (WPF) эта ситуация изменилась за счет ввода
модели с совершенно другим устройством. Хотя платформа WPF включает знакомые
стандартные элементы управления, она рисует каждый текст, контур и фон
самостоятельно. В результате WPF может предоставить намного более мощные
средства, которые позволяют изменить визуализацию любой части экранного
содержимого. С помощью этих средств можно изменить стиль обычных элементов
управления, таких как кнопки, часто даже без написания кода. Кроме того, можно
применять трансформации объектов для вращения, растяжения, масштабирования и
сдвига любой части пользовательского интерфейса, и даже использовать встроенную
систему анимации WPF, чтобы делать все это прямо на глазах пользователя. И
поскольку механизм WPF визуализирует содержимое окна как часть одной операции,
он может обрабатывать неограниченное количество слоев перекрывающихся элементов,
даже имеющих нерегулярную форму и частичную прозрачность.

В основе WPF лежит мощная инфраструктура, основанная на DirectX — API-
интерфейсе графики с аппаратным ускорением, который обычно используется в
современных компьютерных играх. Это означает возможность применения развитых
графических эффектов, не платя за это производительностью, как это было в
Windows Forms. Фактически даже становятся доступными такие расширенные средства,
как поддержка видеофайлов и трехмерное содержимое. Используя эти средства (при
наличии хорошего инструмента графического дизайна), можно создавать бросающиеся
в глаза пользовательские интерфейсы и визуальные эффекты, которые были просто
невозможны в Windows Forms.

Графические подсистемы компьютеров продолжали совершенствоваться и дешеветь,
ожидания потребителей росли, но до появления WPF проблеме сложности построения
выразительных пользовательских интерфейсов не уделяли должного внимания.
Некоторые разработчики самостоятельно брались за ее решение, стремясь сделать
свои приложения и элементы управления более привлекательными. Простым примером
тут является использование растровых изображений вместо стандартных кнопок.
Однако мало того что подобные нестандартные решения было трудно реализовывать,
они еще зачастую оказывались ненадежными. Основанные на них приложения не всегда
доступны людям с ограниченными возможностями, плохо адаптируются к высокому
разрешению и имеют другие визуальные огрехи.

Корпорация Microsoft понимала, что необходимо нечто совершенно новое, свободное
от ограничений GDI+ и подсистемы USER, но не менее продуктивное и удобное в
использовании, чем Windows Forms. И с учетом роста популярности
кроссплатформенных приложений, основанных на HTML и JavaScript, Windows отчаянно
нуждалась в столь же простой технологии, которая при этом еще и позволяла бы
задействовать все возможности локального компьютера. И Windows Presentation
Foundation (WPF) дала в руки разработчиков ПО и графических дизайнеров тот
инструмент, который был необходим для создания современных решений и не требовал
освоения сразу нескольких сложных технологий.

Трудно оценить важность WPF, не принимая во внимание тот факт, что разработчики
Windows-приложений в течение более 15 лет пользовались, по сути, одной и той же
технологией отображения. Стандартное Windows-приложение при создании
пользовательского интерфейса полагается на две основополагающие части
операционной системы Windows:

* User32 обеспечивает знакомый внешний вид и поведение таких элементов, как
  окна, кнопки, текстовые поля и т.п.;

* GDI/GDI+ предоставляет поддержку рисования фигур, текста и изображений за счет
  дополнительного усложнения (и часто неважной производительности).

Новые платформы просто предоставляют улучшенные оболочки для взаимодействия с
User32 и GDI/GDI+. Они могут быть более эффективными, менее сложными, могут
включать некоторые заранее подготовленные средства, чтобы не приходилось
создавать их самостоятельно, однако они не могут преодолеть фундаментальные
ограничения системных компонентов, разработанных более 10 лет назад.

Это значит, что создается ли сложная трехмерная графика (DirectX's forte), или
просто рисуются кнопки и простой текст — вся работа по рисованию проходит через
конвейер DirectX. В результате даже самые заурядные бизнес-приложения могут
использовать богатые эффекты вроде прозрачности и сглаживания. Также получается
выигрыш от аппаратного ускорения, и это означает, что DirectX передает как можно
больше работы узлу обработки графики (graphics processing unit — GPU), который
представляет собой отдельный процессор на видеокарте.

> :grey_exclamation: Технология DirectX более эффективна, поскольку оперирует
высокоуровневыми конструкциями вроде текстур и градиентов, которые могут
отображаться непосредственно видеокартой. Компонент GDI/GDH- на это не способен,
поэтому ему приходится преобразовывать их в инструкции рисования пикселей, и
потому отображение проходит намного медленнее даже на современных видеокартах.

> :grey_exclamation: Это наиболее существенное изменение в WPF.
Технология WPF — это не оболочка для GDI/GDI+. На самом деле это его замена —
отдельный уровень, работающий через DirectX.

## Наиболее существенные изменения, которые привнесла с собой технология WPF

* Веб-подобная модель компоновки. Вместо того чтобы фиксировать элементы
  управления на месте с определенными координатами, WPF поддерживает гибкий
  поток, размещающий элементы управления на основе их содержимого. В результате
  получается пользовательский интерфейс, который может быть адаптирован для
  отображения высоко динамичного содержимого или к разным языкам.

* Богатая модель рисования. Вместо рисования пикселей в WPF вы имеете дело с
  примитивами — базовыми фигурами, блоками текста и прочими графическими
  ингредиентами. Кроме того, доступны такие новые средства, как действительно
  прозрачные элементы управления, возможность укладывания друг на друга
  множества уровней с разной степенью прозрачности, а также встроенная поддержка
  трехмерной графики.

* Развитая текстовая модель. После многих лет нестандартной обработки текстов
  WPF наконец-то предоставляет Windows-приложениям возможность отображения
  расширенного стилизованного текста в любом месте пользовательского интерфейса.
  И если нужно отображать значительные объемы текста, для повышения
  читабельности можно воспользоваться развитыми средствами отображения
  документов, такими как переносы, разбиение на колонки и выравнивание.

* Анимация как первоклассная программная концепция. В WPF нет необходимости
  использовать таймер для того, чтобы заставить форму перерисовать себя. Вместо
  этого доступна анимация — неотъемлемая часть платформы. Анимация определяется
  декларативными дескрипторами, и WPF запускает ее в действие автоматически.

* Поддержка аудио и видео. Прежние инструментальные наборы для построения
  пользовательских интерфейсов, такие как Windows Forms, были весьма ограничены
  в работе с мультимедиа. Однако WPF включает поддержку воспроизведения любого
  аудио- или видеофайла, поддерживаемого проигрывателем Windows Media, позволяя
  воспроизводить более одного медиафайла одновременно. Что еще больше впечатляет
  — WPF предоставляет в ваше распоряжение инструменты для интеграции
  видеосодержимого в остальную часть пользовательского интерфейса, позволяя
  выполнять такие экзотические трюки, как размещение видеоокна на поверхности
  вращающегося трехмерного куба.

* Стили и шаблоны. Стили позволяют стандартизировать форматирование и
  многократно использовать его по всему приложению. Шаблоны дают возможность
  изменить способ отображения элементов, даже таких основополагающих, как
  кнопки. Построение интерфейса с обложками еще никогда не было таким простым.

* Команды. Большинству пользователей известно, что не имеет значения, откуда они
  инициируют команду открытия (Open) — через меню или панель инструментов;
  конечный результат один и тот же. Теперь эта абстракция доступна коду — можно
  определять команды приложения в одном месте и привязывать их к множеству
  элементов управления.

* Декларативный пользовательский интерфейс. Хотя можно конструировать окно WPF в
  коде, в Visual Studio используется другой подход. Содержимое каждого окна
  сериализуется в виде XML-дескрипторов в документе XAML. Преимущество состоит в
  том, что пользовательский интерфейс полностью отделяется от кода, и дизайнеры
  графики могут использовать профессиональные инструменты для редактирования
  файлы XAML, улучшая внешний вид всего приложения. (XAML — это сокращение от
  Extensible Application Markup Language.

* Приложения на основе страниц. Используя WPF, можно строить браузер-подобные
  приложения, которые позволяют перемещаться по коллекции страниц, оснащенной
  кнопками навигации "вперед" и "назад". WPF автоматически обрабатывает все
  сложные детали, такие как хронология посещения страниц. Проект можно даже
  развернуть в виде браузерного приложения, которое выполняется внутри Internet
  Explorer.

## Основные возможности, которые предоставляет WPF

* **Широкая интеграция.** До WPF разработчикам в Windows, которые хотели
  использовать одновременно 3D-графику, видео, речь и форматированные документы
  в дополнение к обычной двумерной графике и элементам управления, приходилось
  изучать несколько независимых технологий, плохо совместимых между собой и не
  имеющих встроенных средств сопряжения. А в WPF все это входит в состав
  внутренне согласованной модели программирования, поддерживающей композицию и
  визуализацию разнородных элементов.

* **Независимость от разрешающей способности.** Только представьте себе мир, в
  котором переход к более высокому разрешению экрана или принтера не означает,
  что все уменьшается. Вместо этого графические элементы и текст только
  становятся более четкими! Представьте себе пользовательский интерфейс, который
  прекрасно выглядит и на маленьком нетбуке, и на полутораметровом экране
  телевизора! WPF все это обеспечивает и дает возможность уменьшать или
  увеличивать элементы на экране независимо от его разрешения. Это стало
  возможным благодаря тому, что WPF основана на использовании векторной графики.

* **Аппаратное ускорение.** Поскольку WPF основана на технологии Direct3D, то
  все содержимое в WPF-приложении, будь то двумерная или трехмерная графика,
  изображения или текст, преобразуется в трехмерные треугольники, текстуры и
  другие объекты Direct3D, а потом отрисовывается аппаратной графической
  подсистемой компьютера. Таким образом, WPF-приложения задействуют все
  возможности аппаратного ускорения графики, что позволяет добиться более
  качественного изображения и одновременно повысить производительность
  (поскольку часть работы перекладывается с центральных процессоров на
  графические). При этом от применения новых графических ускорителей и их
  драйверов выигрывают все WPFприложения (а не только высококлассные игры). Но
  WPF не требует обязательного наличия высокопроизводительной графической
  аппаратуры.

* **Декларативное программирование.** Декларативное программирование не является
  уникальной особенностью WPF, поскольку в программах на платформе Win16/Win32
  сценарии описания ресурсов для определения компоновки диалоговых окон и меню
  применяются вот уже 25 лет. И в .NET-приложениях часто используются
  декларативные атрибуты наряду с конфигурационными и ресурсными XML-файлами.
  Однако в WPF применение декларативного программирования вышло на новый уровень
  благодаря языку XAML (eXtensible Application Markup Language – расширяемый
  язык разметки приложений). Сочетание WPF и XAML аналогично использованию HTML
  для описания пользовательского интерфейса, но с гораздо более широкими
  выразительными возможностями. И эта выразительность выходит далеко за рамки
  описания интерфейса. В WPF язык XAML применяется в качестве формата
  документов, для представления 3D-моделей и многого другого.

* **Богатые возможности композиции и настройки.** В WPF элементы управления
  могут сочетаться немыслимыми ранее способами. Можно создать комбинированный
  список, содержащий анимированные кнопки, или меню, состоящее из видеоклипов!
  Конечно, сама мысль о таком интерфейсе может привести в ужас, но важно то, что
  для оформления элемента способом, о котором его автор и не помышлял, не
  понадобится писать никакой (!) код (и в этом коренное отличие от
  предшествующих технологий, где отрисовка элементов жестко задавалась
  создателем кода).